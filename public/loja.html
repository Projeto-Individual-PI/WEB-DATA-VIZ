<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/loja.css">
    <title>Loja</title>
</head>

<body>
    
        <div class="box1">
            <div class="mascara">
                <div class="header">
                    <div style="
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    height: 100%;
                    width: 100%;
                    gap: 50px;"
                    class="opcoes">    

                    <div class="login">
                        <a href="./inventario.html">
                            Inventário
                        </a>
                    </div>  
                    <div class="sobre">
                        Home
                    </div>

                    <div class="cadastro">
                        <a href="./loja.html">

                            Loja
                        </a>
                    </div>
                
                    </div>
                </div>

               


                <div class="painel" id="painel2">
                    <div class="header"><p>Loja</p>
                    </div>
                    <div class="mensagem">
                        <p>
                            Escolha um baú para comprar:
                        </p>
                    </div>                        
                        <div class="mensagem2" id="div_opcoes">
                            <div class="bau_opcoes">
                            <img src="../assets/img-icons/bau-fechado.png" id="1" onclick="confirmar_escolha(this.id)" alt="bau-icon">
                            <span>Baú Comum</span>
                            </div>
                            <div class="bau_opcoes">
                            <img src="../assets/img-icons/bau-fechado.png" id="2" onclick="confirmar_escolha(this.id)" alt="bau-icon">
                            <span>Baú Raro</span>

                            </div>
                            <div class="bau_opcoes">
                                <img src="../assets/img-icons/bau-fechado.png" id="3" onclick="confirmar_escolha(this.id)" alt="bau-icon">
                                <span>Baú Lendário</span>

                            </div>
                        </div>
                            <div class="mensagem3" id="mensagem_creditos">

                        </div>
                        
                    </div>
                    <div class="painel_bau_loja" id="painel_bau_loja">
                        <div class="header">
                            <button onclick="fechar_painel_bau_loja()">X</button>
                        </div>
                        <div id="confirmar">
                            
                        </div>
                    </div>
            </div>
            
        </div>
    </div>
</body>
</html>
<script src="./js/sessao.js"></script>
<script src="./js/loja.js"></script>
<script>
    // window.onload = 
    window.onload =  () => {
        Autenticar_Usuario(sessionStorage.ID_USUARIO, sessionStorage.NOME_USUARIO, sessionStorage.EMAIL_USUARIO);
        Carregar_Inventario(sessionStorage.ID_USUARIO);
        painel2.style.display = 'flex';
    // bau.style.display = 'flex';
    setTimeout(() => {
        painel2.classList.toggle("visible_painel")
        // bau.classList.toggle("visible_bau")
        exibir_creditos(sessionStorage.inventario_creditos);


    },200);

    }

    

async function confirmar_escolha(escolha){
    try {
        var bau_escolhido = await consultar_bau(escolha);
    } catch (erro) {
        console.error("Erro ao confirmar a escolha:", erro);
    }




    painel2.classList.toggle("visible_painel")
    setTimeout(() => {
        painel_bau_loja.style.display = 'flex';
        confirmar.innerHTML = `<h1>Confirme a sua escolha!</h1><br>
                             <p>Você tem certeza que deseja comprar um ${bau_escolhido.nome}?</p>

                             Status do baú <br> 
                             Preço: ${bau_escolhido.preco} créditos <br>
                             Raridades dos itens: <br>
                             <span class="comum">Comum</span>: ${bau_escolhido.porcent_comum}% <br>
                             <span class="incomum">Incomum</span>: ${bau_escolhido.porcent_incomum}% <br>
                             <span class="raro">Raro</span>: ${bau_escolhido.porcent_raro}% <br>
                             <span class="epico">Épico</span>: ${bau_escolhido.porcent_epico}% <br>   
                             <span class="lendario">Lendário</span>: ${bau_escolhido.porcent_lendario}% <br>
                            <button class="confirmar_botao" onclick="realizar_compra('${bau_escolhido.preco}', '${bau_escolhido.idBau}')">CONFIRMAR</button>
                             
                             `;
        painel2.style.display = 'none';
        setTimeout(() => {
            painel_bau_loja.classList.toggle("visible_painel_bau_loja")
        },200)

    },750);
}




async function realizar_compra(bau_preco, bau_id) {
    await reduzir_credito(sessionStorage.ID_USUARIO, sessionStorage.inventario_creditos, bau_preco)
    // console.log(bau_id);
    await enviar_bau(sessionStorage.ID_USUARIO, bau_id)

    alert('COMPRA REALIZADA COM SUCESSO!!!!')
    fechar_painel_bau_loja();
    Carregar_Inventario(sessionStorage.ID_USUARIO);
}



</script>


